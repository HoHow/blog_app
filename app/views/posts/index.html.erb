<h1>文章列表</h1>

<!-- 標籤雲 -->
<% if @all_tags.any? %>
  <div class="tag-cloud mb-4">
    <h5>熱門標籤：</h5>
    <% @all_tags.each do |tag| %>
      <%= link_to tag.name, posts_path(tag: tag.name), class: "badge bg-secondary me-1 mb-1 text-decoration-none", style: "font-size: #{[tag.count * 2 + 8, 16].min}px;" %>
      <span class="text-muted small">(<%= tag.count %>)</span>
    <% end %>
    <% if params[:tag].present? %>
      <div class="mt-2">
        <span class="text-info">目前篩選標籤：<strong><%= params[:tag] %></strong></span>
        <%= link_to "清除標籤篩選", posts_path, class: "btn btn-sm btn-outline-secondary ms-2" %>
      </div>
    <% end %>
  </div>
<% end %>

<!-- 搜尋表單 -->
<%= simple_search_form_for_posts %>

<!-- 搜尋結果統計 -->
<% if params[:q].present? %>
  <div class="alert alert-info">
    <%= search_results_count %>
    <%= clear_search_link %>
  </div>
<% end %>

<% if @posts.any? %>
  <div class="posts-grid">
    <% @posts.each do |post| %>
      <div class="post-card">
        <div class="post-header">
          <h3 class="post-title">
            <%= link_to post.title, post_path(post), class: "post-link" %>
          </h3>
          <span class="post-author">作者：<%= post.user.username %></span>
        </div>
        <div class="post-content">
          <%= truncate(post.content.to_plain_text, length: 200) %>
        </div>
        
        <!-- 文章標籤 -->
        <% if post.tag_list.any? %>
          <div class="post-tags mb-2">
            <% post.tag_list.each do |tag| %>
              <%= link_to tag, posts_path(tag: tag), class: "badge bg-light text-dark me-1 text-decoration-none" %>
            <% end %>
          </div>
        <% end %>
        
        <div class="post-footer">
          <span class="post-date">發布時間：<%= post.updated_at.strftime("%Y-%m-%d %H:%M") %></span>
          <span class="badge bg-success">已發布</span>
        </div>
      </div>
    <% end %>
  </div>
<% else %>
  <div class="no-posts">
    <p>目前還沒有已發布的文章。</p>
    <% if logged_in? %>
      <p><%= link_to "立即發布第一篇文章", new_users_post_path, class: "btn btn-primary" %></p>
    <% else %>
      <p><%= link_to "登入", login_path, class: "btn btn-primary" %> 來發布文章</p>
    <% end %>
  </div>
<% end %>