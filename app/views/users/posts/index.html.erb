
<!-- 搜尋表單 -->
<%= search_form_for_posts %>

<!-- 搜尋結果統計 -->
<% if params[:q].present? %>
  <div class="alert alert-info">
    <%= search_results_count %>
    <%= clear_search_link %>
  </div>
<% end %>

<% if @posts.any? %>
  <table class="table">
    <thead>
      <tr>
        <th>標題</th>
        <th>內容</th>
        <th>標籤</th>
        <th>狀態</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody>
      <% @posts.each do |post| %>
        <tr>
          <td><%= post.title %></td>
          <td><%= truncate(post.content.to_plain_text, length: 100) %></td>
          <td>
            <% if post.tag_list.any? %>
              <% post.tag_list.each do |tag| %>
                <%= link_to tag, users_posts_path(tag: tag), class: "badge bg-light text-dark me-1 text-decoration-none" %>
              <% end %>
            <% else %>
              <span class="text-muted">無標籤</span>
            <% end %>
          </td>
          <td>
            <span class="badge <%= post.status == 'published' ? 'bg-success' : (post.status == 'draft' ? 'bg-warning' : 'bg-danger') %>">
              <%= case post.status
                  when 'published'
                    '已發布'
                  when 'draft'
                    '草稿'
                  when 'deleted'
                    '已刪除'
                  else
                    post.status
                  end %>
            </span>
          </td>
          <td>
            <%= link_to "查看", users_post_path(post), class: "btn btn-info btn-sm" %>
            <%= link_to "編輯", edit_users_post_path(post), class: "btn btn-primary btn-sm" %>
            
            <% if post.draft? %>
              <%= link_to "發布", publish_users_post_path(post), data: { turbo_method: :patch, turbo_confirm: "確定要發布嗎？" }, class: "btn btn-success btn-sm" %>
            <% elsif post.published? %>
              <%= link_to "取消發布", unpublish_users_post_path(post), data: { turbo_method: :patch, turbo_confirm: "確定要取消發布嗎？" }, class: "btn btn-warning btn-sm" %>
            <% end %>
            
            <% unless post.deleted? %>
              <%= link_to "刪除", delete_users_post_path(post), data: { turbo_method: :patch, turbo_confirm: "確定要刪除嗎？" }, class: "btn btn-danger btn-sm" %>
            <% else %>
              <%= link_to "恢復", restore_users_post_path(post), data: { turbo_method: :patch, turbo_confirm: "確定要恢復嗎？" }, class: "btn btn-secondary btn-sm" %>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <div class="no-posts">
    <p>您還沒有任何文章。</p>
    <p><%= link_to "立即建立第一篇文章", new_users_post_path, class: "btn btn-primary" %></p>
  </div>
<% end %>
